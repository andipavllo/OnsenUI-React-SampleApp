<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="mobile-web-app-capable" content="yes" />

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
    <script src="lib/onsen/js/ons-core.js"></script>
    <script src="lib/react/react.js"></script>
    <script src="lib/react/JSXTransformer.js"></script>

    <!-- CSS dependencies -->
    <link rel="stylesheet" href="lib/onsen/css/onsenui.css" />
    <link rel="stylesheet" href="lib/onsen/css/onsen-css-components.css" />

    <style>
      img {
        position: absolute;
        top: 0;
        bottom: 0;
        left: 0;
        right: 0;
        max-width: 85%;
        margin: auto;
      }

      .navigation-bar {
        background-color: #125688;
      }

      .navigation-bar__center {
        color: #fafafa;
      }

      .prev-button {
        position: absolute;
        font-size: 30px;
        left: 30px;
        bottom: 20px;
        color: #125688;
        z-index: 1;
      }

      .next-button {
        position: absolute;
        font-size: 30px;
        right: 30px;
        bottom: 20px;
        color: #125688;
        z-index: 1;
      }

    </style>

    <!-- --------------- App init --------------- -->

    <script type="text/jsx">
        /** @jsx React.DOM */

        var Carousel = React.createClass({
          render: function() {
            return (
              <div>
                <PictureList apiKey="642176ece1e7445e99244cec26f4de1f" />
              </div>
            );
          }
        });

        // In this example we also have two components - a picture and
        // a picture list. The pictures are fetched from Instagram via AJAX.

        var PictureList = React.createClass({

          getInitialState: function(){

            // The pictures array will be populated via AJAX, and
            // the favorites one when the user clicks on an image:

            return {
              pictures: []
            };
          },

          componentDidMount: function(){

            // When the component loads, send a jQuery AJAX request

            var self = this;

            // API endpoint for Instagram's popular images for the day

            var url = 'https://api.instagram.com/v1/media/popular?client_id=' + this.props.apiKey + '&callback=?';

            var pictures;

            $.getJSON(url, function(result){

              if(!result || !result.data || !result.data.length){
                  return;
              }

             pictures = result.data.map(function(p){

                  return {
                      id: p.id,
                      url: p.link,
                      src: p.images.low_resolution.url,
                      title: p.caption ? p.caption.text : ''
                  };
              });

              // Update the component's state. This will trigger a render.

              self.setState({ pictures: pictures });
            });
          },

          componentDidUpdate: function(){
            this.refs.carousel.refresh();
          },

          prev: function() {
            this.refs.carousel.prev();
          },

          next: function() {
            this.refs.carousel.next();
          },

          render: function() {
              return (
                <ons-carousel ref="carousel" swipeable auto-scroll fullscreen overscrollable>
                  <ons-icon class="prev-button" onClick={this.prev} icon="arrow-left"></ons-icon>
                  <ons-icon class="next-button" onClick={this.next} icon="arrow-right"></ons-icon>
                  {this.state.pictures.map(function(value) {
                    return <ons-carousel-item key={value.id}>
                        <img className="centered" key={value.id} src={value.src}></img>
                      </ons-carousel-item>
                  })}
                </ons-carousel>
              );
          }
      });

      // Renders the Carousel component, and add it to the content div.
      React.render(
        <Carousel />,
        document.getElementById('content')
      );
    </script>
</head>

<body>
  <ons-page>
    <ons-toolbar>
      <div class="center">Onstagram</div>
    </ons-toolbar>
    <div id="content"></div>
  </ons-page>
</body>
</html>
